@model IEnumerable<BitxifyProduct.Models.ProductModel>

@{
ViewData["Title"] = "Products";
}

<h2 class="mb-3">Product List</h2>

<table class="table table-bordered" id="productTable">
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Price ($)</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    @foreach (var item in Model)
    {
    <tr data-id="@item.Id">
        <td>@item.Id</td>
        <td>@item.Name</td>
        <td>@item.Price</td>
        <td>
            <button class="btn btn-warning btn-sm btn-update" data-id="@item.Id">Update</button>
            <button class="btn btn-danger btn-sm btn-delete" data-id="@item.Id">Delete</button>
        </td>
    </tr>
    }
    </tbody>
</table>

<hr />

<h3>Add Product</h3>
<form id="addProductForm">
    <div class="form-group">
        <label>Name:</label>
        <input type="text" name="Name" class="form-control" required />
    </div>
    <div class="form-group">
        <label>Price:</label>
        <input type="number" step="0.01" name="Price" class="form-control" required />
    </div>
    <button type="submit" class="btn btn-success mt-2">Add Product</button>
</form>

@section Scripts {
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    // GET by ID
    $(".btn-get").click(function () {
        var id = $(this).data("id");
        $.get("/Home/GetDetailsById", { id: id }, function (res) {
            if (res.responseCode === 0) {
                var product = JSON.parse(res.responseMessage);
                alert("ID: " + product.Id + "\nName: " + product.Name + "\nPrice: " + product.Price);
            } else {
                alert(res.responseMessage);
            }
        });
    });

    // POST - Insert
    $("#addProductForm").submit(function (e) {
        e.preventDefault();
        var formData = $(this).serialize();
        $.post("/Home/InsertProduct", formData, function (res) {
            if (res.responseCode === 0) {
                var product = JSON.parse(res.responseMessage);
                $("#productTable tbody").append(
                    "<tr data-id='" + product.Id + "'>" +
                    "<td>" + product.Id + "</td>" +
                    "<td>" + product.Name + "</td>" +
                    "<td>" + product.Price + "</td>" +
                    "<td>" +
                    "<button class='btn btn-info btn-sm btn-get' data-id='" + product.Id + "'>Get</button> " +
                    "<button class='btn btn-warning btn-sm btn-update' data-id='" + product.Id + "'>Update</button> " +
                    "<button class='btn btn-danger btn-sm btn-delete' data-id='" + product.Id + "'>Delete</button>" +
                    "</td></tr>"
                );
            } else {
                alert(res.responseMessage);
            }
        });
    });

    // PUT - Update
    $(document).on("click", ".btn-update", function () {
        var id = $(this).data("id");
        var newName = prompt("Enter new name:");
        var newPrice = prompt("Enter new price:");
        if (newName && newPrice) {
            $.ajax({
                url: "/Home/UpdateProduct",
                type: "PUT",
                data: { id: id, name: newName, price: newPrice },
                success: function (res) {
                    if (res.responseCode === 0) {
                        var product = JSON.parse(res.responseMessage);
                        var row = $("tr[data-id='" + id + "']");
                        row.find("td:eq(1)").text(product.Name);
                        row.find("td:eq(2)").text(product.Price);
                    } else {
                        alert(res.responseMessage);
                    }
                }
            });
        }
    });

    // DELETE
    $(document).on("click", ".btn-delete", function () {
        var id = $(this).data("id");
        if (confirm("Are you sure to delete product #" + id + "?")) {
            $.ajax({
                url: "/Home/DeleteProduct",
                type: "DELETE",
                data: { id: id },
                success: function (res) {
                    if (res.responseCode === 0) {
                        $("tr[data-id='" + id + "']").remove();
                    } else {
                        alert(res.responseMessage);
                    }
                }
            });
        }
    });
</script>
}
